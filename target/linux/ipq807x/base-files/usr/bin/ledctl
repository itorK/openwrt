#!/bin/sh
# Author: Karol Przybylski <itor@o2.pl>

LP5569_1=0-0032
LP5569_2=0-0035
# LED representing by Red Green Blue 
LED_1=001
LED_2=001
LED_3=100
LED_4=100
LED_5=001
LED_6=001

MICROCODE=9d80400004ff05ff437f0000

usage() {
  echo "usage: $0 [start|stop|status]"
}


load_firmware() {
  echo 1 > /sys/bus/i2c/devices/0-0032/select_engine
  sleep 1
  echo 1 > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_1}/firmware/lp5569/loading
  echo ${MICROCODE} > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_1}/firmware/lp5569/data
  sleep 1
  echo 0 > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_1}/firmware/lp5569/loading

  echo 1 > /sys/bus/i2c/devices/0-0035/select_engine
  sleep 1
#  echo 1 > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_2}/firmware/lp5569/loading
#  echo ${MICROCODE} > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_2}/firmware/lp5569/data
  sleep 1
#  echo 0 > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_2}/firmware/lp5569/loading
}

led_start() {
  load_firmware
  echo ${LED_1}${LED_2}${LED_3} > /sys/bus/i2c/devices/${LP5569_1}/engine1_leds
  echo 1 > /sys/bus/i2c/devices/${LP5569_1}/run_engine
  
  echo ${LED_6}${LED_5}${LED_4} > /sys/bus/i2c/devices/${LP5569_2}/engine1_leds
  echo 1 > /sys/bus/i2c/devices/${LP5569_2}/run_engine
}

led_stop() {
  echo 0 > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_1}/led_pattern
  echo 0 > /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_2}/led_pattern
}

led_status() {
  status=`cat /sys/devices/platform/soc/78b6000.i2c/i2c-0/${LP5569_1}/engine1_mode`
  echo  $status 
}

case $1 in
  start)
    led_start
    ;;
  stop)
    led_stop
    ;;
  status)
    led_status
    ;;
  *)
    usage
    ;;
esac

exit 0

